%{{{ [vim] 
% vim:foldmarker=%{{{,%}}}
% vim:foldmethod=marker
% vim:foldcolumn=4
%}}}
%% thatexmath.tex
%% author: Thanos Tsouanas <thanos@tsouanas.org>

\message{[ThaTeX-math]}

%%{{{ amstex & friends 
\let\knuthcases=\cases
\let\knuthproclaim=\proclaim
\let\knuthfootnote=\footnote
\let\knuthS=\S
\let\footnotebeforeamstex=\footnote
\input amstex
\let\footnote=\footnotebeforeamstex
\let\footnotebeforeamstex\relax
% euler fonts
\loadmsam % ams fonts
\loadmsbm % ams fonts
\loadbold % math bold fonts
\loadeufm % fraktur medium-weight 
%\loadeufb % fraktur bold
%\loadeusm % script medium-weight
%\loadeusb % script bold
%\loadeurm % cursive roman medium-weight
%\loadeurb % cursive roman bold
\let\AMSproclaim=\proclaim
\let\proclaim\relax
\input stmary  % does this load amssym?
\input ofs
\input amsfn
\input mathdots

% ofs
\def\fomenc{AMS}
\setsimplemath

% load the rsfs(o) fonts
\font\tenscr=rsfso10
\font\sevenscr=rsfso7
\font\fivescr=rsfso5
\skewchar\tenscr='177 \skewchar\sevenscr='177 \skewchar\fivescr='177
\newfam\scrfam \textfont\scrfam=\tenscr \scriptfont\scrfam=\sevenscr \scriptscriptfont\scrfam=\fivescr
\def\scr#1{{\fam\scrfam#1}}

% load the ams msbm fonts
% use bbold10, bbold7, bbold5 for an alternative font
% that supports more characters (and digits!)
\font\tenbbb=msbm10
\font\sevenbbb=msbm7
\font\fivebbb=msbm5
\skewchar\tenbbb='177 \skewchar\sevenbbb='177 \skewchar\fivebbb='177
\newfam\bbbfam \textfont\bbbfam=\tenbbb \scriptfont\bbbfam=\sevenbbb \scriptfont\bbbfam=\fivebbb
\def\bbb#1{{\fam\bbbfam#1}}

% load the eufm fonts
\font\teneuf=eufm10
\font\seveneuf=eufm7
\font\fiveeuf=eufm5
\newfam\euffam \textfont\euffam=\teneuf \scriptfont\euffam=\seveneuf \scriptfont\euffam=\fiveeuf
\def\euf#1{{\fam\euffam#1}}

%%}}}

%%{{{ mathfonts 
\def\mathit#1{\hbox{\text{\it#1}}}
\def\mathrm#1{\hbox{\text{\rm#1}}}
\def\mathrmsmall#1{\hbox{\text{\sevenrm#1}}}
\def\mathrmtiny#1{\hbox{\text{\sixrm#1}}}
\def\mathsf#1{\hbox{\text{\sf#1}}}
\def\mathsfbf#1{\hbox{\text{\sfbf#1}}}
\def\mathsfmbf#1{\hbox{\text{\sfmbf#1}}}
\def\mathsc#1{\hbox{\text{\scshape #1}}}
\def\mathtt#1{\hbox{\text{\tt#1}}}
\def\mathbf#1{\hbox{\text{\bf#1}}}
\def\txt#1{\text{\tt #1}}
\def\textrm#1{\text{\rm#1}}
\def\namedrel#1{\operatorname{#1}\nolimits}
\def\namedfun#1{\mathord{\mathit{#1}}}% for functions
\def\namedfpf#1{\mathord{\mathit{#1}}}% for functional programming functions
\def\namedtype#1{\mathord{\mathsf{#1}}}
\def\namedop#1{\operatorname{#1}}
\def\cal{\Cal}
%%}}}

%%{{{ funky symbols 
\def\woohoo{{\ddot\smile}}
\def\boohoo{{\ddot\frown}}
%%}}}

%%{{{ standard sets 
\def\nats{{\bbb N}}
\def\rats{{\bbb Q}}
\def\algs{{\bbb A}}
\def\ints{{\bbb Z}}
\def\reals{{\bbb R}}
\def\complex{{\bbb C}}
\def\bools{{\bbb B}}
\def\polys#1#2{#1\bracket{#2}}
%%}}}

%%{{{ alternative font for other uses (for example implementations) 
\def\Nats{{\mathord{\mathbf N}}}
\def\Rats{{\mathord{\mathbf Q}}}
\def\Ints{{\mathord{\mathbf Z}}}
\def\Reals{{\mathord{\mathbf R}}}
\def\Complex{{\mathord{\mathbf C}}} 
\def\Zero{{\mathsf 0}}%
\def\Succ{{\mathsf S}}%
%%}}}

%%{{{ metadefs 
% \DefPar assumes that its argument is a defined macro of arity 0
% and it creates its parenthesized version, of arity 1
% Example:
% \DefPar succ
% assumes the existence of \succ of arity 0 and it defines \succP of arity 1
\def\DefPar#1 {\expandafter\def\csname #1P\endcsname##1{\csname #1\endcsname\funparen{##1}}}
% \DefApp is similar but defines a space-as-application version
\def\DefApp#1 {\expandafter\def\csname #1A\endcsname##1{\csname #1\endcsname\fa{##1}}}
% \DefTHING #1 #2 \defs a command #1 to be printed as #2 and also takes care
% of the definition of the "parenthesized" version of it if it makes sense
\def\DefREL#1 #2  {\expandafter\def\csname #1\endcsname{{\namedrel{#2}}}\DefPar #1 }
\def\DefFUN#1 #2  {\expandafter\def\csname #1\endcsname{{\namedfun{#2}}}\DefPar #1 \DefApp #1 }
\def\DefFPF#1 #2  {\expandafter\def\csname #1\endcsname{{\namedfpf{#2}}}\DefPar #1 \DefApp #1 }
\def\DefOP#1 #2   {\expandafter\def\csname #1\endcsname{{\namedop{#2}}}\DefPar  #1 }
\def\DefTYPE#1 #2 {\expandafter\def\csname #1\endcsname{{\namedtype{#2}}}}
% Use plain \DefThing if the command name coincides with the printed name
\def\DefRel#1  {\DefREL #1 #1 }
\def\DefFun#1  {\DefFUN #1 #1 }
\def\DefFpf#1  {\DefFPF #1 #1 }
\def\DefOp#1   {\DefOP #1 #1 }
\def\DefType#1 {\DefTYPE #1 #1 }
% WARNING: use the above macros without % at the end, because it needs
% (and eats) the whitespace.  For example:
% \DefFUN suc succ
% \DefFun fib
% These will create the macros: \suc, \sucP, \fib, \fibP
% TODO: create \KnuthSave macro
%%}}}

%%{{{ elementary math 
\def\abs#1{\left|#1\right|}
\def\bigabs#1{\mathopen{\big|}{#1}\mathclose{\big|}}
\def\sizeof#1{\left|#1\right|}
\def\frac#1#2{{#1\over#2}}
\def\ntimes{\mathbin{\cdot}}
\def\nplus{\mathbin{+}}
\def\stimes{\,}
\def\expop{\mathbin{\caret}}
\def\pow#1{^{#1}}
\def\plus{+}
\def\floor#1{\left\lfloor#1\right\rfloor}
\def\ceil#1{\left\lceil#1\right\rceil}
\def\cancel#1{\tikz[baseline] \node [strike out,draw,anchor=text,inner sep=0pt,color=black!33,text=black]{$#1$};}
\def\cancelspc#1{\cancel{\,#1\,}}
\def\coloredcancel#1#2{\tikz[baseline] \node [strike out,draw,anchor=text,inner sep=0pt,color=#1,text=black]{$#2$};}
\def\plusinfty{{+\infty}}
\def\minusinfty{{-\infty}}
\def\pminfty{{\pm\infty}}
\def\mpinfty{{\mp\infty}}
\let\pinfty=\plusinfty
\let\minfty=\minusinfty
\let\posinfty=\pinfty
\let\neginfty=\minfty
\let\nifty=\neginfty
\def\interval#1#2#3{\left#1{#2}\right#3}
\let\ival=\interval
\def\cbrt#1{{\root3\of{#1}}}
\def\fac#1{{#1}!}
\def\facp#1{\fac{\paren{#1}}}
\def\system#1{\aligned#1\endaligned}
\def\lsystem#1{\left\{\system{#1}\right.}
\def\rsystem#1{\left.\system{#1}\right\}}
\def\bsystem#1{\left\{\system{#1}\right\}}
\def\segment#1{\overline{#1}}
\def\veq{\mathrel{\tikz\node [rotate=90] {=};}}
%%}}}

%%{{{ matrices 
\def\matrixp#1{\pmatrix#1\endpmatrix}
%%}}}

%%{{{ misc symbols 
\let\knuthphi=\phi
\let\phi=\varphi
\def\caret{\hat{}}
%%}}}

%%{{{ combinatorics 
\def\totperm#1{P_{\text{\sevenss tot}}(#1)}
\def\perm#1#2{P(#1,#2)}
\def\comb#1#2{C(#1,#2)}
\def\binom#1#2{{{#1} \choose {#2}}}
\def\transto{\mathrel{\rightsquigarrow}}
\def\transfrom{\mathrel{\leftsquigarrow}}
\def\bitrans{\leftrightsquigarrow}
\def\permf#1{\matrixp{#1}}
\def\permc#1{{\def\quad{\ \,}\permf{#1}}}
%%}}}

%%{{{ layout/text tools 
\def\leftbrace#1{\left\{#1\right.}
\def\rightbrace#1{\left.#1\right\}}
\let\knuthbrace=\brace
\def\brace#1{\left\{#1\right\}}
\def\leftangle#1{\left<#1\right.}
\def\rightangle#1{\left.#1\right>}
\definecolor{explanationcolor}{cmyk}{0,0,0,.666}
\def\explanationstyle#1{{\color{explanationcolor} #1}}
\def\fact#1{~\ensuremath{^{\text{\explanationstyle{(#1)}}}}}
\def\byfact#1{\text{\explanationstyle{(#1)}}}
\def\reffact#1{\text{\explanationstyle{(#1)}}}
\def\mathby#1{\text{\explanationstyle{(#1)}}}
\def\explanation#1{\text{\explanationstyle{(#1)}}}
\def\nbby#1{&\qquad&\mathby{#1}}
\def\by#1{\nbby{#1}\\}
\def\bytag#1#2{\nbby{#1}\tag{#2}\\}
\def\called#1{&\qqqquad&\textrm{(#1)}\\}
\def\qtext#1{\quad\text{#1}\quad}
\def\qqtext#1{\qquad\text{#1}\qquad}
\def\qqqtext#1{\qqquad\text{#1}\qqquad}
\def\qqqqtext#1{\qqqquad\text{#1}\qqqquad}
\def\toverbrace#1#2{\overbrace{#1}^{\text{\eightrm #2}}}% XXX: default \text can't display some non-ascii
\def\moverbrace#1#2{\overbrace{#1}^{{#2}}}
\def\moverbraceleg#1#2{\moverbrace {#1} {\dsize #2}}% legible version
\def\tunderbrace#1#2{\underbrace{#1}_{\text{\eightrm #2}}}% XXX: default \text can't display some non-ascii
\def\munderbrace#1#2{\underbrace{#1}_{{#2}}}
\def\munderbraceleg#1#2{\munderbrace {#1} {\dsize #2}}% legible version
\let\tobrace=\toverbrace
\let\mobrace=\moverbrace
\let\tubrace=\tunderbrace
\let\mubrace=\munderbrace
\let\mobraceleg=\moverbraceleg
\let\mubraceleg=\munderbraceleg
\def\shell#1\endshell{$$\xxalignat2\relax #1\endxxalignat$$}% TODO: make a real shell macro
\def\compute#1\endcompute{$$\alignat2\relax #1\endalignat$$}
\def\computed#1\endcomputed{\alignedat2\relax #1\endalignedat}
\def\stepproof#1\endstepproof{$$\alignat2\relax #1\endalignat$$}
\def\ttherefore{$\therefore$~~}
\def\proofsteptnb#1{&\text{#1}\\}
\def\proofstepmnb#1{&{#1}\\}
\def\proofsteptby#1#2{&\text{#1}\by{#2}}
\def\proofstepmby#1#2{&{#1}\by{#2}}
\def\thereforetby#1#2{\proofsteptby{\ttherefore#1}{#2}}
\def\thereforemby#1#2{\proofsteptby{\ttherefore$#1$}{#2}}
\def\thereforetnb#1{\proofsteptnb{\ttherefore#1}}
\def\thereforemnb#1{\proofsteptnb{\ttherefore$#1$}}
\def\thereforet#1{\text{\ttherefore #1}}
%%}}}

%%{{{ generic TeX symbol machinery 
\def\smartnot{\mathpalette\NoT}
\def\NoT#1#2{\mathrel{\ooalign{\hfil$#1{#2}$\hfil\cr\hfil$#1/$\hfil}}}
\def\stackrel#1#2{{\buildrel{#1} \over {#2}}}
% aperlis *laps
\def\clap#1{\hbox to 0pt{\hss#1\hss}}
\def\mathllap{\mathpalette\mathllapinternal}
\def\mathrlap{\mathpalette\mathrlapinternal}
\def\mathclap{\mathpalette\mathclapinternal}
\def\mathllapinternal#1#2{\llap{$\mathsurround=0pt#1{#2}$}}
\def\mathrlapinternal#1#2{\rlap{$\mathsurround=0pt#1{#2}$}}
\def\mathclapinternal#1#2{\clap{$\mathsurround=0pt#1{#2}$}}
%%}}}

%%{{{ generic tools 
\def\ensuremath#1{\ifmmode#1\else$#1$\fi}
%\def\eqvdots{\mathmakebox[\widthof{${}={}$}][c]{\vdots}}
\def\eqvdots{\mathrel{\,\,\kern-.05em\mathord{\vdots}\,}}
\def\eqtype{\mathrel{\,\,\kern-.05em:\,}}
\def\treedots{\mathord{\ddots\kern-0.333em\vdots\kern-0.333em\iddots}}
%%}}}

%%{{{ number theory 
\def\divides{\mathrel{\mid}}
\def\divideseqwidth{\;\mathrel{\mid}\;}
\let\knuthcong=\cong
\let\knuthncong=\ncong
\def\cong{\equiv}
\undefine\ncong
\def\ncong{\mathrel{\not\equiv}}
\def\congmod#1#2{#2 \pmod {#1})}
\def\modulo#1{\left(\mod{#1}\right)}
\def\ndivides{\mathrel{\nmid}}
\def\gengcd#1{\mathopen{\text{\rm gcd}(}#1\mathclose{)}}
\def\genlcm#1{\mathopen{\text{\rm lcm}(}#1\mathclose{)}}
\def\gcd#1#2{\left(#1,#2\right)}
\def\lcm#1#2{\left[#1,#2\right]}
\def\totsym{\varphi}
\def\tot#1{\mathopen{\totsym}\left({#1}\right)\mathclose{}}
\DefRel Prime
\DefRel Even
\DefRel Odd
%%}}}

%%{{{ logic metalang 
%\def\iffdf{\mathrel{\overset\triangle\iff}}
\def\iffsymbol{\Longleftrightarrow}
\def\impliessymbol{\Longrightarrow}
\def\impliedbysymbol{\Longleftarrow}
\def\defiff{\mathrel{{\buildrel{\text{\sixss def}} \over {\iff}}}}
\def\alertdefiff{\mathrel{{\buildrel{\text{\sixss \alert{def}}} \over {\iff}}}}
\def\defiffsymbol{\mathop{\buildrel{\text{\sixss def}} \over {\Longleftrightarrow}}}
\def\impliesbecause#1{\mathrel{{\buildrel{\text{\explanationstyle{\sixrm #1}}} \over {\implies}}}}
\def\pseudodefiff{\mathrel{{\buildrel{\text{\sixss ``def''}} \over {\iff}}}}
\def\askiff{\mathrel{{\buildrel{\text{?}} \over {\iff}}}}
\def\askimplies{\mathrel{{\buildrel{\text{?}} \over {\implies}}}}
\def\askimpliedby{\mathrel{{\buildrel{\text{?}} \over {\impliedby}}}}
\def\askdots{{\dots\text{?}\dots}}
\def\assiff{\mathrel{\;:\Longleftrightarrow \;}}
\let\letiff=\assiff
\def\defeq{\mathrel{{\buildrel{\text{\sixss def}} \over {=}}}}
\def\alertdefeq{\mathrel{{\buildrel{\text{\sixss \alert{def}}} \over {=}}}}
\def\pseudodefeq{\mathrel{{\buildrel{\text{\sixss ``def''}} \over {=}}}}
\def\pseudoeq{\mathrel{\textrm{``$\mathord{=}$''}}}
\def\dotseq{\mathrel{{\buildrel{{...}} \over {=}}}}
\def\dotsiff{\mathrel{{\buildrel{{\dots}} \over {\iff}}}}
\def\askeq{\mathrel{{\buildrel{\text?} \over {=}}}}
\def\asteq{\mathrel{{\buildrel{\text*} \over {=}}}}
\def\eqlabel#1{\mathrel{{\buildrel{\text{\explanationstyle{(#1)}}} \over {=}}}}
\def\ifflabel#1{\mathrel{{\buildrel{\text{\explanationstyle{(#1)}}} \over {\iff}}}}
\def\eqass{\mathrel{=:}}
\def\asseq{\mathrel{:=}}
\let\leteq=\asseq
\let\eqlet=\eqass
\def\mland{{\mathbin{\;\;\text{\rm \andword}\;\;}}} % metalang and
\def\mlor{{\mathbin{\;\;\text{\rm \orword}\;\;}}}   % metalang or
\def\notimplies{\smartnot\implies}
\let\nimplies=\notimplies
\def\lrdir{($\Rightarrow$)}
\def\rldir{($\Leftarrow$)}
\def\bidir{($\Leftrightarrow$)}
\def\lrdirset{($\subset$)}
\def\rldirset{($\supset$)}
\def\rlrewrite#1{{#1}$^\leftarrow$}
\def\lrrewrite#1{{#1}$^\rightarrow$}
\def\syneq{\mathrel{\equiv}}        % syntactic
\def\synasseq{\mathrel{:\equiv}}
\def\synneq{\mathrel{\smartnot{\syneq}}}
\def\inteq{\mathrel{\equiv}}        % intensional
\def\intneq{\mathrel{\smartnot{\inteq}}}
\def\semeq{\mathrel{\eqcirc}}
\def\semneq{\mathrel{\not\eqcirc}}
\let\abbreq=\syneq
\let\sugareq=\syneq
\def\tripleiff{{\Lleftarrow\mkern-3mu\Rrightarrow}} % symbol
\def\tripledefiff{\;\mathrel{{\buildrel{\text{\sixss def}} \over {\tripleiff}}\;}} % symbol
\def\abbrdefeq{\mathrel{{\buildrel{\text{\sixss def}} \over {\abbreq}}}}
\def\sugardefeq{\mathrel{{\buildrel{\text{\sixss def}} \over {\sugareq}}}}
\def\sugardefiff{\;\mathrel{{\buildrel{\text{\sixss def}} \over {\tripleiff}}\;}}
\def\intiff{\;\mathrel{\tripleiff}\;}
\def\sugariff{\intiff}
\let\sugiff=\sugariff
\let\sugdefeq=\sugardefeq
\let\sugdefiff=\sugardefiff
\let\abbriff=\sugariff
\let\abbrdefiff=\sugdefiff
\def\eqin#1{\mathrel{=_{#1}}}
\let\eqas=\eqin
\def\leadsto{\mathrel{\rightsquigarrow}}
\def\leadstoby#1{\decorateover{#1}{\leadsto}}
%%}}}

%%{{{ grammars 
\def\bnf#1{\left<\mathit{#1}\,\right>}
\def\bnfeq{\mathrel{\,::=\,}}
\def\bnfor{\mathrel{\,\mid\,}}
\def\bnfOR{\mathrel{\,\phantom{::}\,|\,\,\,}}
%%}}}

%%{{{ logic formulae 
\def\univ{U}
\def\limplies{\mathbin{\rightarrow}}
\def\limplied{\mathbin{\leftarrow}}
\def\liff{\mathbin{\leftrightarrow}}
\def\unique{{\exists!}}
\def\quantified#1{\bracket{\thinspace#1\thinspace}}
\def\quantifierabbr#1#2#3{\left(\/#1 #2\right)\!\quantified{#3}}
\def\lforall{\quantifierabbr{\forall}}
\def\lexists{\quantifierabbr{\exists}}
\def\lunique{\quantifierabbr{\unique}}
\def\pexists#1{\paren{\exists#1}}
\def\pforall#1{\paren{\forall#1}}
\def\punique#1{\paren{\unique#1}}
\def\sexists#1{{\exists#1}\,}
\def\sforall#1{{\forall#1}\,}
\def\sunique#1{{\unique#1}\,}
\def\zolang{{\frak L_0}}
\def\folang{{\frak L_1}}
\def\zolvars{{\mathrm{Pvar}}}
\def\folvars{{\mathrm{Var}}}
\def\folcons{{\mathrm{Con}}}
\def\folfuns{{\mathrm{Fun}}}
\def\folpreds{{\mathrm{Pred}}}
\def\folterms{{\cal T}}
\def\folarity{{\mathbf{a}}}
\def\lsym#1{\mathsf{#1}}
%%}}}

%%{{{ metalang formula-like notations 
\def\mexists{\exists}
\def\mforall{\forall}
\def\munique{\unique}
\def\mlimplies{\implies}
\def\mliff{\iff}
\def\mlimplied{\impliedby}
\def\mlquantified#1{\bracket{\thinspace#1\thinspace}}
\def\mlquantifierabbr#1#2#3{\left(\/#1 #2\right)\!\mlquantified{#3}}
\def\mlforall{\mlquantifierabbr{\forall}}
\def\mlexists{\mlquantifierabbr{\exists}}
\def\mlunique{\mlquantifierabbr{\unique}}
\def\mlunique{\mlquantifierabbr{\unique}}
\def\mpexists#1{\paren{\mexists#1}}
\def\mpforall#1{\paren{\mforall#1}}
\def\mpunique#1{\paren{\munique#1}}
\def\tforall{\rotated{180}{A}}
\def\texists{\rotated{180}{E}}
%%}}}

%%{{{ booleans 
\def\True{\mathsf{True}}
\def\False{\mathsf{False}}
%%}}}

%%{{{ sets, relations, and functions 
\let\knuthsubset=\subset
\let\knuthsupset=\supset
\let\knuthsubseteq=\subseteq
\let\knuthsubsetneq=\subsetneq
\let\knuthsupseteq=\supseteq
\let\knuthsupsetneq=\supsetneq
\let\knuthnsubseteq=\nsubseteq
\let\knuthnsupseteq=\nsupseteq
\let\subset=\UNDEFINED
\let\subseteq=\UNDEFINED
\let\subsetneq=\UNDEFINED
\let\supset=\UNDEFINED
\let\supseteq=\UNDEFINED
\let\supsetneq=\UNDEFINED
\def\subset{\knuthsubseteq}
\def\supset{\knuthsupseteq}
\def\propersubset{\knuthsubsetneq}
\def\propersupset{\knuthsupsetneq}
\let\proper=\propersubset
\let\psubset=\propersubset
\let\psupset=\propersupset
\let\subsetneq=\propersubset
\let\supsetneq=\propersupset
\let\contains=\supset
\let\containd=\supset       % contain'd
\let\pcontains=\psupset
\let\pcontaind=\psubset
\def\nsubset{\smartnot\subset}
\def\nsupset{\smartnot\supset}
\def\notni{\smartnot\ni}
\def\nleq{\mathrel{\not\leq}}
\def\ngeq{\mathrel{\not\geq}}
\def\intersection{\cap}
\let\inter=\intersection
\def\Intersection{\bigcap}
\let\Inter=\Intersection
\def\union{\cup}
\def\Union{\bigcup}
\def\Unionl{\Union\nolimits}% same line
\def\Interl{\Inter\nolimits}% same line
\def\limit{\lim\nolimits}% same line
\let\liminflimits=\liminf
\let\limsuplimits=\limsup
\edef\liminf{\liminf\nolimits}
\edef\limsup{\limsup\nolimits}
\let\minus=\setminus
\def\Product{\prod}
\let\Prod=\Product
\def\symdiff{\mathbin{\triangle}}
\def\surjto{\mathrel{\rightarrow\mkern-15mu\rightarrow}}
\let\surto=\surjto
\def\injto{\mathrel{\rightarrowtail}}
\def\bijto{\mathrel{\injto\mkern-15mu\rightarrow}}
\def\parto{\mathrel{\rightharpoonup}}
\def\ndeto{\mathrel{\rightsquigarrow}}
\def\decorateover#1#2{\mathrel{{\buildrel{#1} \over {#2}}}}
\def\to{\mathrel{\rightarrow}}
\def\from{\mathrel{\leftarrow}}
\def\longto{\mathrel{\mathord{-\mkern-8mu-\mkern-8mu\longrightarrow}}}
\def\longfrom{\mathrel{\mathord{\longleftarrow-\mkern-8mu-\mkern-8mu}}}
\def\toby#1{\mathrel{\decorateover{#1}{\mathord{-\mkern-8mu-\mkern-8mu\longrightarrow}}}}
\def\inctoby#1{\mathrel{\decorateover{#1}{\mathord{\incto}}}}
\def\longtoby#1{\mathrel{\decorateover{#1}{\mathord{\nrepeat{4}{-\mkern-8mu}\longrightarrow}}}}
\def\xlongtoby#1{\mathrel{\decorateover{#1}{\mathord{\nrepeat{12}{-\mkern-8mu}\longrightarrow}}}}
\def\fromby#1{\mathrel{\decorateover{#1}{\mathord{\longleftarrow\mkern-8mu-\mkern-8mu-}}}}
\def\longfromby#1{\mathrel{\decorateover{#1}{\mathord{\longleftarrow\nrepeat{4}{\mkern-8mu-}}}}}
\def\xlongfromby#1{\mathrel{\decorateover{#1}{\mathord{\longleftarrow\nrepeat{12}{\mkern-8mu-}}}}}
\def\reltoby#1{\mathrel{\decorateover{#1}{\mathord{-\mkern-8mu-\mkern-8mu\rightarrowtriangle}}}}
\def\relfromby#1{\mathrel{\decorateover{#1}{\mathord{\leftarrowtriangle\mkern-8mu-\mkern-8mu-}}}}
\let\rtoby=\reltoby
\let\rfromby=\relfromby
\let\ftoby=\toby
\let\ffromby=\fromby
\let\longmapsto=\knuthlongmapsto % save original longmapsto
\def\longmapsto{\mathrel{\cdopt{nodes={inner sep=0}} {} \ar[r, mapsto] \| {} \endcd}}
\def\longmapsfrom{\mathrel{\cdopt{nodes={inner sep=0}} {} \ar[r, mapsfrom] \| {} \endcd}}
\def\mapstoby#1{\mathrel{\cdopt{nodes={inner sep=0}} {} \ar[r, mapsto, "#1"] \| {} \endcd}}
\def\mapsfromby#1{\mathrel{\cdopt{nodes={inner sep=0}} {} \ar[r, mapsfrom, "#1"] \| {} \endcd}}
\def\bijtoby#1{\mathrel{\cdopt{nodes={inner sep=0}} {} \ar[r, tail, two heads, "#1"] \| {} \endcd}}
\def\injtoby#1{\mathrel{\cdopt{nodes={inner sep=0}} {} \ar[r, tail, "#1"] \| {} \endcd}}
\def\surtoby#1{\mathrel{\cdopt{nodes={inner sep=0}} {} \ar[r, two heads, "#1"] \| {} \endcd}}
\def\set#1{\left\{#1\right\}}
\def\fsset#1{\{#1\}}% fixed-size set
\def\bigset#1{{\mathopen{\big\{}{#1}\mathclose{\big\}}}}% forced big-size set
\def\tupa#1{\left\langle#1\right\rangle}
\def\tupp#1{\left(#1\right)}
\let\tup=\tupa
\def\proj#1{\pi_{#1}}% projections of implicit arity (pi-notation)
\def\projfrom#1#2{\pi^{#1}_{#2}}% projections of denoted arity (pi-notation)
\def\tproj#1{\namedfun{proj}_{#1}}% projections of implicit arity (proj-notation)
\def\tprojfrom#1#2{\namedfun{proj}^{#1}_{#2}}% projections of denoted arity (proj-notation)
\def\pproj#1#2{\paren{#2}_{#1}}% parenthesized projection via subscript
\DefFun fst
\DefFun snd
\DefFun swap
\DefFun outl
\DefFun outr
\DefFun inl
\DefFun inr
\let\knuthsucc=\succ% save original math symbol
\DefFun succ
\DefFun curry
\DefFun uncurry
\DefFun apply
\def\paren#1{{\left({#1}\right)}}
\def\nparen#1{{(\left.{#1}\right.)}}% forced normal-size parens
\def\lparen#1{{\left({#1}_{\vphantom ,}\right)}}% smart-large parens XXX
\def\bigparen#1{{\mathopen{\big(}{#1}\mathclose{\big)}}}% forced big-size parens
\def\Bigparen#1{{\mathopen{\Big(}{#1}\mathclose{\Big)}}}% forced Big-size parens
\def\biggparen#1{{\mathopen{\bigg(}{#1}\mathclose{\bigg)}}}% forced bigg-size parens
\let\funparen=\paren
\def\bracket#1{{\left[{#1}\right]}}
\def\bigbracket#1{{\mathopen{\big[}{#1}\mathclose{\big]}}}
\def\Bigbracket#1{{\mathopen{\Big[}{#1}\mathclose{\Big]}}}
\def\st{\;\mathord{\pmb{\mid}}\;}
\def\setst#1#2{\set{\,#1 \;\st\; #2\,}}% set such that
\def\setstt#1#2{\set{\,#1 \;\st\; \text{#2}\,}}% textmode in filter
\def\setlst#1#2{\set{\,#1 \ \;\middle|\;\  #2\,}}% sufficiently long such that
\def\setlstt#1#2{\set{\,#1 \ \;\middle|\;\  \text{#2}\,}}% + textmode in filter
\def\famst#1#2{{\paren{\,{#1} \,\st\, #2\,}}}
\def\family#1#2{{\paren{{#1}}_{#2}}}
\def\famil#1#2#3{{\family {{#1}_{#2}} {{#2}\in{#3}}}}
\def\faml#1#2{{\family {{#1}_{#2}} {{#2}}}}
\def\sequence#1#2{{\set{#1}_{#2}}}
\def\seqn#1#2{\sequence {{#1}_{#2}} {#2}}
\def\ssetp#1#2{({#1}\mathrel{;}{#2})}
\def\sseta#1#2{\langle{#1}\mathrel{;}{#2}\rangle}
\let\sset=\ssetp
\def\ssetfont{\cal}
\def\finsubset{\subset_{\text{\sixss fin}}}
\def\finpsubset{\psubset_{\text{\sixss fin}}}
\def\pset{{\wp}}
\def\psetfin{{\wp_{\text{\rm f}}}}
\let\powerset=\pset
\let\pfset=\psetfin
\def\psetp#1{\pset\funparen{#1}}
\def\card#1{\abs{#1}}
\def\id{\mathrm{id}}
\def\idof#1{\mathord{\id}_{#1}}
\let\iddom=\idof
\def\idone#1{\mathord{1_{#1}}}
%\def\cod{\mathop{\rm cod}\nolimits}
%\def\coim{\mathop{\rm coim}\nolimits}
\def\coim{\namedop{coim}}
\def\dom{\namedop{dom}}
\def\cod{\namedop{cod}}
\def\compose{\mathbin{\circ}}
\def\fcompose{\mathbin{\circ}}
\def\rcompose{\mathbin{\diamond}}
\def\dcompose{\mathbin{;}}
\let\rcom=\rcompose
\let\fcom=\fcompose
\let\dcom=\dcompose
\let\com=\compose
\def\trel#1{<<#1>>}
\def\mtrel#1{\text{<<#1>>}}
\def\eqclass#1#2{\bracket{{#1}}_{#2}}
\def\eqclassalt#1#2{[\mathord{#1}\mathord{/}\mathord{#2}]}
\def\eqclassimp#1{[#1]}
\def\quoset#1#2{\mathord{#1}\mathord{/}\mathord{#2}}
\DefOp graph
\DefOp range
\def\funimg#1#2{#1\bracket{#2}}
\def\funpreimg#1#2{#1^{-1}\bracket{#2}}
\let\img=\funimg
\let\pre=\funpreimg
\let\rel=\mathrel
\def\relp#1{\rel{\paren{#1}}}
\let\of=\fcompose
\let\following=\compose
\def\incto{\mathrel{\hookrightarrow}}
\def\resto{\mathbin{\mkern-2mu\upharpoonright\mkern-1mu}}
\def\restosub#1{\mathord{|}_{#1}}
\def\resfun#1#2{{#1}\resto{#2}}
\def\resfunsub#1#2{{#1}\restosub{#2}}
\def\ton#1{\rel{\to^{#1}}}
\def\ifthenelse#1#2#3{\mathbf{if}~#1~\mathbf{then}~#2~\mathbf{else}~#3}
\def\pifthenelse#1#2#3{\paren{\ifthenelse{#1}{#2}{#3}}}
\def\IF#1\THEN#2\ELSE#3\FI{\ifthenelse{#1}{#2}{#3}}
\def\PIF#1\THEN#2\ELSE#3\FIP{\pifthenelse{#1}{#2}{#3}}
\def\lam#1#2{\lambda\,{#1}\,.\,{#2}}
\def\lamt#1#2{\lambda\,{#1}\,.\,{\text{#2}}}
\def\lamp#1#2{\lam{#1}{\paren{#2}}}% parenthesize body
\def\plam#1#2{\nparen{\lam{#1}{#2}}}% parenthesize whole term
\def\plamt#1#2{\nparen{\lamt{#1}{#2}}}
\def\plamp#1#2{\nparen{\lamp{#1}{#2}}}
\def\lapp{\nobreak\;\nobreak}% lambda term application
\def\fapp{\nobreak~\nobreak}% function application
\def\lappp#1{\lapp\paren{#1}}% parenthesized arg lapp
\def\fappp#1{\fapp\paren{#1}}% parenthesized arg fapp
\let\fa=\fapp
\let\fap=\fappp
\let\la=\lapp
\let\lap=\lappp
\def\descrsym{\iota}
\def\descr#1#2{\descrsym\,{#1}\,.\,{#2}}
\def\bag#1{\mathord{\Lbag#1\Rbag}}
\def\inbag{\mathrel{\varepsilon}}
\def\bagunion{\mathbin{\Cup}}
\def\baginter{\mathbin{\Cap}}
\def\bagplus{\mathbin{\oplus}}
\def\notinbag{\mathrel{\mkern-2mu\not{\mkern-3mu\varepsilon}}}
\def\subbag{\mathrel{\Subset}}
\def\notsubbag{\mathrel{\not\Subset}}
\def\emptybag{\bag{\mkern-3mu}}
\def\finv#1{{#1}^{-1}}
\def\finvp#1{\finv{\paren{#1}}}
\def\rinv#1{\rel{{#1}^{-1}}}
\def\rinvp#1{\rinv{\paren{#1}}}
\def\rop#1{\rel{{#1}^{\partial}}}
\def\ropp#1{\rop{\paren{#1}}}
\def\frel#1{\approx_{#1}}
\def\relto{\mathbin{\rightarrowtriangle}}
\def\relfrom{\mathbin{\leftarrowtriangle}}
\let\rto=\relto
\let\fto=\to
\def\refclosure#1{\mathrel{{#1}_{\textrm{r}}}}
\def\symclosure#1{\mathrel{{#1}_{\textrm{s}}}}
\def\transclosure#1{\mathrel{{#1}_{\textrm{t}}}}
\def\reftransclosure#1{\mathrel{{#1}_{\textrm{rt}}}}
\let\rclosure=\refclosure
\let\sclosure=\symclosure
\let\tclosure=\transclosure
\let\rtclosure=\reftransclosure
\def\rclo#1{\mathrel{{#1}^{=}}}
\def\sclo#1{\mathrel{{#1}^{\leftrightarrow}}}
\def\tclo#1{\mathrel{{#1}^{+}}}
\def\rtclo#1{\mathrel{{#1}^{*}}}
\def\cclo#1{\mathrel{{#1}^{\circ}}}
\def\reclo#1{\mathrel{{#1}^{\triangleleft}}}
\def\leclo#1{\mathrel{{#1}^{\triangleright}}}
\def\transcl#1{\decorateover{+}{#1}}
\def\rtranscl#1{\decorateover{*}{#1}}
\def\symcl#1{\decorateover{\leftrightarrow}{#1}}
\def\refcl#1{\decorateover{=}{#1}}
\def\cross{\times}
\def\fpair#1#2{\mathord{\tup{#1,#2}}}
\def\fcross#1#2{\mathord{#1\cross#2}}
\def\pfcross#1#2{\mathord{\paren{#1\cross#2}}}
\def\diag{\Delta} % diagonal
\def\diagdom#1{\diag_{#1}}
\def\chr#1{\chi_{#1}}
\def\chrdom#1#2{\chr{#2}^{#1}}
\def\kon#1{\mathrm{k}_{#1}}
\def\kondom#1#2{\kon{#2}^{#1}}
\def\inc{\imath}
\def\incofin#1#2{\inc_{#1\incto#2}}
\def\app{\nobreak\,\nobreak}
%%}}}

%%{{{ lambda calculus 
\def\Llam#1#2{\lambda\,{#1}\,.\,{#2}}
\def\Lmac#1{\underline{\mathtt{#1}}}
\def\Lfinto{\rightarrow\mathrel{\kern-.8em}\rightarrow}
\def\Lnum#1{{\underline{#1}}}
\def\lamstep{\mathrel{\;\triangleright_{\kern-.4em}{}_{\phantom{\beta}}\;}}
\def\invstep{\phantom{\lamstep}}
\def\betastep{\mathrel{\;\triangleright_{\kern-.4em{}_\beta}\;}}
\def\etastep{\mathrel{\;\triangleright_{\kern-.4em{}_\eta}\;}}
\def\alphastep{\mathrel{\;\triangleright_{\kern-.4em{}_\alpha}\;}}
\let\lstep=\lamstep
\let\istep=\invstep
\let\bstep=\betastep
\let\estep=\etastep
\let\astep=\alphastep
\def\lameq{\mathrel{\,=\,}}
\def\isteq{\istep\lameq}% istep-indent equals
\def\redex#1{\underline{#1}}
%%}}}

%%{{{ combinatory logic 
\def\C#1{{\mathord{\mathsfmbf{#1}}}}
\def\Cto{\mathrel{\triangleright}}
\def\cI{{\C I}}
\def\cK{{\C K}}
\def\cM{{\C M}}
\def\cC{{\C C}}
\def\cS{{\C S}}
\def\cW{{\C W}}
\def\cB{{\C B}}
\def\cR{{\C R}}
\def\cV{{\C V}}
\def\cBp{{{\C B}'}}
%%}}}

%%{{{ set theory 
\def\cantorcard#1{\overline{\overline{#1}}}
\def\cantorset{{\frak C}}
\def\continuum{\euf{c}}
\def\finord#1{\overline{#1}}
\def\eqc{\mathrel{=_{\namedop{c}}}}
\def\neqc{\mathrel{\not\eqc}}
\def\leqc{\mathrel{\leq_{\namedop{c}}}}
\def\geqc{\mathrel{\geq_{\namedop{c}}}}
\def\gtc{\mathrel{>_{\namedop{c}}}}
\def\ltc{\mathrel{<_{\namedop{c}}}}
\def\Univ{{\bbb V}}
\def\complement#1{\widetilde{#1}}
\let\compl=\complement
\def\russell#1{{\mathbf{r}(#1)}}
\def\metain{\mathrel{\in\kern-0.425em\in}}
\let\inclass=\metain
\def\class#1#2{\pmb{\{}\;{#1}\;\st \;{#2}\;\pmb{\}}}
\def\classt#1#2{\pmb{\{}\;{#1}\;\st \;{\text{#2}}\;\pmb{\}}}
\def\classimg#1#2{{#1}{\pmb[}\,{#2}\,{\pmb]}}
\def\universet{{\cal U}}
\DefRel Eq
\DefRel Set
\DefRel Singleton
\DefRel Doubleton
\DefRel Empty
\DefRel Universal
\DefRel Set
\DefRel Pair
\DefRel Function
\DefRel Relation
\DefRel Infinite
\DefFun first
\DefFun second
\def\relspace#1{\namedop{Rel}\funparen{#1}}
\def\reltype#1{\namedop{Rel}\funparen{#1}}
\def\kurpair#1#2{\set{\set{#1}, \set{{#1}, {#2}}}}
\def\disjunion{\mathbin{\uplus}}
\def\Disjunion{\biguplus}
\let\dunion=\disjunion
\let\Dunion=\Disjunion
\def\setsucc#1{{#1}{}^+}
\def\kleenestar#1{{#1}^\star}
\def\kleenestarp#1{\paren{#1}^\star}
\let\kstar=\kleenestar
\let\kstarp=\kleenestarp
%%}}}

%%{{{ type theory 
\def\type#1{{\namedtype{#1}}}
\DefType Nat
\def\oftype{\mathrel{:}}
\let\is=\oftype
\def\rule#1{{\scshape #1}}
%%}}}

%%{{{ order theory 
\def\smallcovby{\mathrel{-\mkern-8mu\Yleft}}
\def\covby{\mathrel{-\mkern-9mu<}}
\def\wellbelow{\mathrel{\ll}}
\let\wbelow=\wellbelow
\def\incomparable{\mathrel{\mid\mkern-2mu\mid}}
\def\altincomparable{\mathrel{\rangle\mkern-5mu\langle}}
\let\incomp=\incomparable
\def\embto{\mathrel{\hookrightarrow}}
\def\embijto{\hookrightarrow\mathrel{\mkern-15mu}\rightarrow}
\def\dmnd{\mathbin{\diamond}}
\def\join{\mathbin{\vee}}
\def\meet{\mathbin{\wedge}}
\def\Join{\bigvee}
\def\Meet{\bigwedge}
\def\downsets#1{\cal O(#1)}
\let\downs=\downsets
\def\down{\mathord{\downarrow}}
\def\up{\mathord{\uparrow}}
\def\dualposet#1{{#1}^\partial}
\let\dual=\dualposet
\def\ubs#1{{#1}^{\mathrmtiny{U}}}
\def\lbs#1{{#1}^{\mathrmtiny{L}}}
\def\lub{\namedop{lub}}
\def\glb{\namedop{glb}}
\def\fixpoints{\namedop{Fix}}
\def\lfp{\namedop{lfp}}
\def\gfp{\namedop{gfp}}
%%}}}

%%{{{ group theory 
\def\quogroup#1#2{\quoset#1#2}
\let\quogrp=\quogroup
\def\gord#1{\mathord{\it o}\funparen{#1}}
\def\tord#1{\mathrm{ord}\funparen{#1}}
\def\bord#1{\abs{#1}}
\def\ginv#1{{#1}^{-1}}
\def\ginvp#1{\ginv{\funparen{#1}}}
\def\ginvt{\namedfun{inv}}
\def\ima{\namedop{im}}
\def\sym#1{S_{#1}}
\def\dih#1{{{\cal D}_{#1}}}
\def\dihalt#1{{\mathrm{Dih}_{#1}}}
\makeatletter
\def\pmodL#1{\allowbreak \ifinner \mkern 8mu\else \mkern 18mu\fi ({\fam \z@ mod_{L}}\,\,#1)}
\def\pmodR#1{\allowbreak \ifinner \mkern 8mu\else \mkern 18mu\fi ({\fam \z@ mod_{R}}\,\,#1)}
\makeatother
\def\gconj#1{\sigma_{#1}}
\def\gconjrel{\approx}
\def\gcl#1{\namedop{Cls}\funparen{#1}}
\let\groupord=\gord
\def\subgroup{\leq}
\def\nsubgroup{\nleq}
\let\subgrp=\subgroup
\let\nsubgrp=\nsubgroup
\def\generate#1{\left\langle#1\right\rangle}
\let\gen=\generate
\def\normalsubgroup{\mathrel{\trianglelefteq}}
\let\normal=\normalsubgroup
\let\normsub=\normalsubgroup
\def\cosetsL#1{{\cal L}_{#1}}
\def\cosetsR#1{{\cal R}_{#1}}
\def\congL#1{\mathrel{{}_{#1}{\cong}}}
\def\congR#1{\mathrel{\cong_{#1}}}
\DefOp Hom
\DefOp End
\DefOp Aut
\DefOp Inn
\DefOp Out
\def\groupind#1#2{\left|\mathord{#1}\mathbin{:}\mathord{#2}\right|}
\def\altgroupind#1#2{i_{#1}(#2)}
\def\centralizer#1{{\mathrm Z}(#1)}
\def\normalizer#1{{\mathrm N}(#1)}
\def\centralizerin#1#2{{\mathrm Z}_{#1}(#2)}
\def\normalizerin#1#2{{\mathrm N}_{#1}(#2)}
\let\centizer=\centralizer
\let\normizer=\normalizer
\let\cizer=\centizer
\let\nizer=\normizer
\let\centizerin=\centralizerin
\let\normizerin=\normalizerin
\let\cizerin=\centizerin
\let\nizerin=\normizerin
\def\gcenter#1{\cizer{#1}}
\def\actorL#1{\mathord{\paren{#1\uhole}}}% Left
\def\actorR#1{\mathord{\paren{\uhole#1}}}% Right
\def\actorS#1#2{\mathord{\paren{#1\uhole#2}}}% Stereo
%%}}}

%%{{{ structured sets 
\def\isomorphicto{\mathrel{\knuthcong}}
\let\isomorphic=\isomorphicto
\let\isoto=\isomorphic
\let\iso=\isoto
%%}}}

%%{{{ placeholder hole 
\definecolor{holecolor}{cmyk}{.25,.05,.05,0}
\def\hole{{\ensuremath{\colorbox{holecolor}{$\phantom{x}$}}}}
\def\dhole{{\mathord{-}}}
\def\bhole{{\mathord{\bullet}}}
\def\uhole{{\mathord{\_}}}
\def\thole{\thinspace\vrule height 0.0pt depth 0.4pt width 1em\thinspace}
\def\lthole{\thinspace\vrule height 0.0pt depth 0.4pt width 2em\thinspace}
\def\xlthole{\thinspace\vrule height 0.0pt depth 0.4pt width 4em\thinspace}
\def\askhole{{\thole?\thole}}
\def\asklhole{{\lthole?\lthole}}
\def\askbox{{\holed ?}}
\def\namedhole#1{\text{\thole$#1$\thole}}
\def\holed#1{{\ensuremath{\colorbox{holecolor}{$#1$}}}}
\def\dotswithsome#1{\dots#1\dots#1\dots}
\def\holewithsome#1{\lthole#1\lthole#1\lthole}
%%}}}

%%{{{ strings 
\def\concat{\mathbin{+\mkern-8mu+}}
%%}}}

%%{{{ algorithm styling 
\def\algorithmstyle#1{\text{{\scshape #1}}}
%%}}}

%%{{{ code 
\def\code#1{\mathtt{#1}}
%%}}}

%%{{{ numerical 
\def\digit#1{\text{\sf #1}}
\def\numeral#1{\underline{\text{\sf #1}}}
%%}}}

%%{{{ complex numbers 
\def\modulus#1{\left|#1\right|}
%%}}}

%%{{{ analysis 
\def\norm#1{\left\Vert#1\right\Vert}
\def\limto{\mathrel{\to}}
\let\tendsto=\limto
\let\tends=\tendsto
\def\convexhull#1{\left\langle#1\right\rangle}
\let\hull=\convexhull
%%}}}

%%{{{ givens/goals table 
\def\gg\givens#1\goals#2\endgg{%
{%
\halign{
\hfil##\hfil &\strut\vrule \hfil##\hfil\cr
{\bf \givensname} & {\bf \goalsname}\cr\noalign{\hrule}
\vtop{%
\def\git##1{##1\cr}%
\def\gim##1{$##1$\cr}%
\halign{~##~\hfil\cr
#1
}}
&
\vtop{%
\def\git##1{##1\cr}%
\def\gim##1{$##1$\cr}%
\halign{~##~\hfil\cr
#2
}}\cr
}
}
}

\def\proofrepl#1\givens#2\goals#3\endproofrepl{%
{%
\endgraf\bigskip\noindent
\hbox to \hsize{
\vtop{
\halign to .333\hsize{##\hfil\cr
\proofstyle{\proofname.}\cr
#1
}
}
\hfill
\vtop{
\halign{
\hfil##\hfil &\strut\vrule \hfil##\hfil\cr
{\bf \givensname} & {\bf \goalsname}\cr\noalign{\hrule}
\vtop{%
\def\git##1{##1\cr}%
\def\gim##1{$##1$\cr}%
\halign{~##~\hfil\cr
#2
}}
&
\vtop{%
\def\git##1{##1\cr}%
\def\gim##1{$##1$\cr}%
\halign{~##~\hfil\cr
#3
}}\cr
}
}
}
}
}

%%}}}

